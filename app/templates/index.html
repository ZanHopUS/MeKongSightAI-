<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mekong Sight AI - Hệ Thống Giám Sát Thông Minh</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div id="login-container" class="login-wrapper">
        <div class="login-box">

            <!-- CỘT GIỚI THIỆU -->
            <div class="login-intro">
                <i class="fas fa-seedling intro-icon"></i>
                <h1>Mekong Sight AI</h1>
                <p class="intro-desc">
                    Hệ thống giám sát thông minh hỗ trợ bà con canh tác
                    <strong>Lúa – Tôm</strong> thích ứng biến đổi khí hậu.
                </p>

                <ul class="intro-features">
                    <li><i class="fas fa-check-circle"></i> Theo dõi độ mặn, mực nước, pH, nhiệt độ</li>
                    <li><i class="fas fa-bell"></i> Cảnh báo rủi ro môi trường sớm</li>
                    <li><i class="fas fa-robot"></i> AI tư vấn mùa vụ & chẩn đoán bệnh</li>
                </ul>
            </div>

            <!-- CỘT ĐĂNG NHẬP -->
            <div class="login-content">
                <div class="brand-login">
                    <h2>Đăng nhập hệ thống</h2>
                    <p>Dành cho người dân và cán bộ quản lý</p>
                </div>

                <div id="login-error" class="login-error"></div>

                <form onsubmit="handleLogin(event)">
                    <div class="input-group">
                        <label>Tên đăng nhập</label>
                        <input type="text" id="username" placeholder="Nhập tên đăng nhập">
                    </div>

                    <div class="input-group">
                        <label>Mật khẩu</label>
                        <input type="password" id="password" placeholder="Nhập mật khẩu">
                    </div>

                    <button type="submit" class="btn-primary">Đăng nhập</button>
                </form>

                <div class="login-footer">
                    <span>Chưa có tài khoản?</span>
                    <a href="/register">Đăng ký ngay</a>
                </div>
            </div>

        </div>
    </div>
    <div id="main-app" class="app-container" style="display: none;">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="brand-logo">
                    <i class="fas fa-seedling"></i>
                    <span>Mekong Sight</span>
                </div>
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <h4 id="display-name">Người dùng</h4>
                        <span id="station-id" class="station-badge">ST-01</span>
                    </div>
                </div>
            </div>

            <nav>
                <div class="nav-section">
                    <div class="nav-section-title">Điều khiển</div>
                    <a href="#" id="nav-dashboard" class="nav-link active" onclick="switchPage('dashboard')">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" id="nav-history" class="nav-link" onclick="switchPage('history')">
                        <i class="fas fa-chart-line"></i>
                        <span>Lịch sử</span>
                    </a>
                    <a href="#" id="nav-weather" class="nav-link" onclick="switchPage('weather')">
                        <i class="fas fa-cloud-sun"></i>
                        <span>Thời tiết</span>
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Công cụ</div>
                    <a href="#" id="nav-ai" class="nav-link" onclick="switchPage('ai')">
                        <i class="fas fa-robot"></i>
                        <span>Trợ lý AI</span>
                    </a>
                </div>
                <a href="#" class="nav-link logout" onclick="handleLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Đăng xuất</span>
                </a>
            </nav>
        </aside>

        <main class="content-area">
            <div id="page-dashboard" class="page-section active">
                <div class="page-header">
                    <div class="page-header-content">
                        <div class="page-title">
                            <h1>Dashboard Giám Sát</h1>
                            <div class="page-subtitle">
                                <i class="fas fa-calendar-alt"></i>
                                <span id="current-date"></span>
                                <i class="fas fa-clock"></i>
                                <span id="current-time"></span>
                            </div>
                        </div>
                        <div class="crop-selector">
                            <div class="crop-selector-item">
                                <label>Loại cây trồng</label>
                                <select id="crop-type" onchange="updateVarieties()">
                                    <option value="rice">Lúa</option>
                                    <option value="shrimp">Tôm</option>
                                </select>
                            </div>
                            <div class="crop-selector-item">
                                <label>Giống</label>
                                <select id="crop-variety" onchange="updateThresholds()">
                                    <option value="st25">ST24/ST25</option>
                                    <option value="om5451">OM5451</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page-content">

                    <div class="card" id="season-info-panel"
                        style="border-top: 4px solid #059669; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 25px; background: white;">

                        <div class="card-header"
                            style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid #eee;">
                            <h3 class="card-title"
                                style="margin: 0; font-size: 1.1rem; font-weight: 700; color: #374151; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-seedling" style="color: #059669;"></i>
                                Thông tin mùa vụ hiện tại
                            </h3>

                            <a href="/crop-management" class="btn-edit"
                                style="background-color: #059669; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-size: 0.9rem; font-weight: 600; display: inline-flex; align-items: center; gap: 6px; transition: opacity 0.2s;">
                                <i class="fas fa-edit"></i> Chỉnh sửa
                            </a>
                        </div>

                        <div class="card-content" style="padding: 20px;">
                            <div style="display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-start;">

                                <div style="flex: 1; min-width: 250px;">
                                    <div
                                        style="display: flex; justify-content: space-between; margin-bottom: 12px; border-bottom: 1px dashed #f3f4f6; padding-bottom: 8px;">
                                        <span style="color: #6b7280; font-size: 0.95rem;"><i
                                                class="fas fa-calendar-check"
                                                style="margin-right: 8px; width: 20px; text-align: center;"></i>Ngày
                                            xuống giống:</span>
                                        <strong id="ss-start-date" style="color: #111827;">--/--/----</strong>
                                    </div>

                                    <div
                                        style="display: flex; justify-content: space-between; margin-bottom: 12px; border-bottom: 1px dashed #f3f4f6; padding-bottom: 8px;">
                                        <span style="color: #6b7280; font-size: 0.95rem;"><i class="fas fa-clock"
                                                style="margin-right: 8px; width: 20px; text-align: center;"></i>Thời
                                            gian nuôi:</span>
                                        <strong id="ss-days-count" style="color: #059669; font-size: 1.1rem;">0
                                            ngày</strong>
                                    </div>

                                    <div
                                        style="display: flex; justify-content: space-between; margin-bottom: 12px; border-bottom: 1px dashed #f3f4f6; padding-bottom: 8px;">
                                        <span style="color: #6b7280; font-size: 0.95rem;"><i class="fas fa-chart-line"
                                                style="margin-right: 8px; width: 20px; text-align: center;"></i>Giai
                                            đoạn:</span>
                                        <strong id="ss-stage-name" style="color: #d97706;">Đang cập nhật...</strong>
                                    </div>

                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: #6b7280; font-size: 0.95rem;"><i
                                                class="fas fa-flag-checkered"
                                                style="margin-right: 8px; width: 20px; text-align: center;"></i>Dự kiến
                                            thu
                                            hoạch:</span>
                                        <strong id="ss-harvest-date" style="color: #111827;">--/--/----</strong>
                                    </div>
                                </div>

                                <div
                                    style="width: 140px; display: flex; flex-direction: column; align-items: center; border-left: 1px solid #f3f4f6; padding-left: 20px;">
                                    <div style="position: relative; width: 100px; height: 100px;">
                                        <svg viewBox="0 0 36 36"
                                            style="width: 100%; height: 100%; transform: rotate(-90deg);">
                                            <path
                                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                                fill="none" stroke="#f3f4f6" stroke-width="3" />
                                            <path id="progress-circle-path" stroke-dasharray="0, 100"
                                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                                fill="none" stroke="#059669" stroke-width="3" stroke-linecap="round"
                                                style="transition: stroke-dasharray 1s ease;" />
                                        </svg>
                                        <div
                                            style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                            <span id="progress-text"
                                                style="display: block; font-size: 0.9rem; font-weight: 800; color: #374151;">0%</span>
                                        </div>
                                    </div>
                                    <span style="font-size: 0.8rem; color: #9ca3af; margin-top: 8px;">Tiến độ vụ
                                        mùa</span>
                                </div>
                            </div>

                            <div id="stage-advice"
                                style="margin-top: 15px; background-color: #ecfdf5; border: 1px solid #a7f3d0; border-radius: 8px; padding: 10px 15px; color: #065f46; font-size: 0.9rem; display: flex; align-items: start; gap: 10px;">
                                <i class="fas fa-info-circle" style="margin-top: 3px;"></i>
                                <span>Đang tải dữ liệu mùa vụ...</span>
                            </div>
                        </div>
                    </div>
                    <div class="grid-2">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-tint"></i> Độ mặn nước
                                </h3>
                            </div>
                            <div class="gauge-container">
                                <div class="gauge-background"></div>
                                <div class="gauge-inner"></div>
                                <div id="gauge-needle" class="gauge-needle"></div>
                            </div>
                            <div class="gauge-value">
                                <div class="gauge-value-number" id="val-sal">0.0</div>
                                <div class="gauge-value-unit">‰ (PPT)</div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-exclamation-triangle"></i> Trạng thái môi trường
                                </h3>
                            </div>
                            <div class="status-section">
                                <div id="status-badge" class="status-badge status-safe">
                                    <span class="status-indicator"></span>
                                    <span>TỐT</span>
                                </div>
                                <p style="margin-top: 1rem; color: var(--gray-600); font-size: 0.9375rem;">
                                    <strong>Tiêu chuẩn:</strong> <span id="current-standard">Lúa ST24/ST25</span>
                                </p>
                            </div>
                            <ul id="advice-list" class="alert-list"></ul>
                        </div>
                    </div>
                </div>
                <div class="grid-3">
                    <div class="card metric-card">
                        <div class="metric-icon blue"><i class="fas fa-thermometer-half"></i></div>
                        <div class="metric-info">
                            <div class="metric-label">Nhiệt độ</div>
                            <div class="metric-value" id="val-temp">30°C</div>
                        </div>
                    </div>

                    <div class="card metric-card">
                        <div class="metric-icon purple"><i class="fas fa-flask"></i></div>
                        <div class="metric-info">
                            <div class="metric-label">Độ pH</div>
                            <div class="metric-value" id="val-ph">7.0</div>
                        </div>
                    </div>

                    <div class="card metric-card">
                        <div class="metric-icon yellow"><i class="fas fa-water"></i></div>
                        <div class="metric-info">
                            <div class="metric-label">Mực nước</div>
                            <div class="metric-value" id="val-water">100 cm</div>
                        </div>
                    </div>
                </div>

            </div>

            <div id="page-history" class="page-section">
                <div class="page-header">
                    <div class="page-header-content">
                        <div class="page-title">
                            <h1>Lịch sử dữ liệu</h1>
                            <div class="page-subtitle">
                                <i class="fas fa-database"></i>
                                <span>Biểu đồ và thống kê chi tiết</span>
                            </div>
                        </div>
                        <div class="chart-options">
                            <button class="chart-btn active" onclick="changeRange('24h')">24 giờ</button>
                            <button class="chart-btn" onclick="changeRange('7d')">7 ngày</button>
                            <button class="chart-btn" onclick="changeRange('30d')">30 ngày</button>
                        </div>
                    </div>
                </div>

                <div class="page-content">
                    <div class="grid-2">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-tint"></i>
                                    Độ mặn
                                </h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="salinityChart"></canvas>
                            </div>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-label">Trung bình</div>
                                    <div class="stat-value" id="salinity-avg">0</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Tối thiểu</div>
                                    <div class="stat-value" id="salinity-min">0</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Tối đa</div>
                                    <div class="stat-value" id="salinity-max">0</div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-water"></i>
                                    Mực nước
                                </h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="waterChart"></canvas>
                            </div>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-label">Trung bình</div>
                                    <div class="stat-value" id="water-avg">0</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Tối thiểu</div>
                                    <div class="stat-value" id="water-min">0</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Tối đa</div>
                                    <div class="stat-value" id="water-max">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="page-weather" class="page-section">
                <div class="page-header">
                    <div class="page-header-content">
                        <div class="page-title">
                            <h1>Thời tiết & Thủy triều</h1>
                            <div class="page-subtitle">
                                <i class="fas fa-cloud-sun-rain"></i>
                                <span>Dự báo thời tiết và phân tích AI</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page-content">

                    <div class="weather-top-row">
                        <div class="weather-card-mini">
                            <div class="wc-icon-sm sun"><i class="fas fa-sun"></i></div>
                            <div class="wc-info">
                                <h3>Nhiệt độ</h3>
                                <div class="wc-value" id="weather-temp">--°C</div>
                                <div class="wc-desc" id="weather-desc">--</div>
                            </div>
                        </div>

                        <div class="weather-card-mini">
                            <div class="wc-icon-sm water"><i class="fas fa-water"></i></div>
                            <div class="wc-info">
                                <h3>Triều cường</h3>
                                <div class="wc-value" id="tide-level" style="color: var(--info)">--m</div>
                                <div class="wc-desc" id="tide-advice">--</div>
                            </div>
                        </div>

                        <div class="card ai-weather-card">
                            <div class="card-header" style="border-bottom: none; padding-bottom: 0;">
                                <h3 class="card-title" style="color: var(--info);">
                                    <i class="fas fa-robot"></i> AI DỰ BÁO TÁC ĐỘNG
                                </h3>
                            </div>
                            <div class="ai-weather-content">
                                <div class="alert-content" id="ai-weather-prediction">
                                    <i class="fas fa-spinner fa-spin"></i> Đang phân tích dữ liệu ...
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid-3">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title"><i class="fas fa-thermometer-half"></i> Nhiệt độ</h3>
                            </div>
                            <div class="chart-container"><canvas id="weatherTempChart"></canvas></div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title"><i class="fas fa-cloud-rain"></i> Lượng mưa</h3>
                            </div>
                            <div class="chart-container"><canvas id="rainChart"></canvas></div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title"><i class="fas fa-water"></i> Mực nước triều</h3>
                            </div>
                            <div class="chart-container"><canvas id="tideChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="page-ai" class="page-section">
                <div class="page-header">
                    <div class="page-header-content">
                        <div class="page-title">
                            <h1>Trợ lý AI - Chẩn đoán bệnh</h1>
                            <div class="page-subtitle">
                                <i class="fas fa-microscope"></i>
                                <span>Chuyên gia bệnh học cây trồng (Lúa & Tôm)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page-content">
                    <div class="card">
                        <div class="ai-upload-zone" onclick="document.getElementById('camera-input').click()">
                            <div class="upload-content">
                                <div class="upload-icon-circle">
                                    <i class="fas fa-camera"></i>
                                </div>
                                <div class="upload-text">
                                    <h3>Chụp ảnh hoặc Tải lên</h3>
                                    <p>Hỗ trợ nhận diện bệnh trên lá lúa, thân tôm và môi trường nước</p>
                                </div>
                            </div>
                            <input type="file" id="camera-input" accept="image/*" style="display: none;"
                                onchange="uploadImage()">
                        </div>

                        <div id="ai-result" class="ai-result-container" style="display: none;">
                            <div class="ai-result-grid">
                                <div class="ai-image-col">
                                    <span class="col-label">Ảnh phân tích</span>
                                    <img id="preview-img" class="ai-preview-img" src="" alt="Preview">
                                </div>

                                <div class="ai-text-col">
                                    <span class="col-label">Kết quả từ chuyên gia AI</span>
                                    <div class="diagnosis-card">
                                        <h4 id="ai-status" class="diagnosis-title">
                                            <i class="fas fa-spinner fa-spin"></i> Đang phân tích...
                                        </h4>
                                        <div class="diagnosis-body">
                                            <h5><i class="fas fa-notes-medical"></i> Phác đồ điều trị / Khuyến nghị:
                                            </h5>
                                            <p id="ai-solution">Vui lòng chờ trong giây lát...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="mobile-nav">
        <div class="mobile-nav-inner">
            <div id="mob-dashboard" class="mobile-nav-item active" onclick="switchPage('dashboard')">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </div>
            <div id="mob-history" class="mobile-nav-item" onclick="switchPage('history')">
                <i class="fas fa-chart-line"></i>
                <span>Lịch sử</span>
            </div>
            <div id="mob-weather" class="mobile-nav-item" onclick="switchPage('weather')">
                <i class="fas fa-cloud-sun"></i>
                <span>Thời tiết</span>
            </div>
            <div id="mob-ai" class="mobile-nav-item" onclick="switchPage('ai')">
                <i class="fas fa-robot"></i>
                <span>AI</span>
            </div>
        </div>
    </div>

    <script src="/static/js/script.js?v=2"></script>
</body>

</html>